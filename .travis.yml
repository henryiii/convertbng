language: generic

env:
  global:
    - PROJECT_NAME=convertbng
    - DOCKER_IMAGE=quay.io/pypa/manylinux2010_x86_64
    # LATEST_TAG
    - secure: YfDd96qCm27IwdNdn8L+8dFFqbhNErQsoe1dUFt6aQuXBpH0ncc1KGDdls0g6flhKueieWvwv27tBaKmR1fBnibiIHXSOhlOTJNnUvumDlxiF28qWbCq/ohl90U7ITXiAEe9QjNKiWwbbj8E7cZTbZBcJ4/UJDVoba9S7WQYHzOfFuNhPa/Gimyfbxf8n2ONjEuPaM/iCNh5bjUfHRPmruU1grMAdUDcnzwJxDj7xdBhkylnDE3uvrKMoPluzoFKEUkYIk2S6dKKr5LlMEnR1WzITkVvkVhl2TKCyv3XjhNDpIJ5+CjSZrNDR6qU5w07V36TonZuTd12Ytaml8SZzEJu/oNT3yxG28Pp+QN4VFYfABgBeg0BkWbHqivMkmXKsGGSE/+XRhYNbGdGvmphrRuchi1DYHCXew6/eVr4ZFeXL0ta1Nf0KzRXekZmwhnz+1k+daJqUqu5+24kOUGKvoN8kH6nncW2OLDDcw2zQ1T8bPLOMD8uyDgUat3KC7lO1pBlS/cH1H9CsbH8VhGzth/XSn5JhXs/QxB+zMS/63INX9enr+BCQs5+w7P/IYrLYyqtmOcPNYywiYdz1WhCFiyk5HMc5doSu3x9UAFnXQpUu3PTqSZkiA7M4ctgo8/bFzUPxpJHq5XKD1la+Zxp9/O5h7TJrUWGwq4iCzdU/2E=
addons:
addons:
  homebrew:
    packages:
    - python@2

matrix:
  include:
    - sudo: required
      env: TARGET=x86_64-unknown-linux-gnu
      services:
        - docker
    - os: osx
      osx_image: xcode12.1
      env: TARGET=x86_64-apple-darwin TRAVIS_PYTHON_VERSION=3.7.6 RELEASE_PYTHON_VERSION=-cp37
      sudo: required
    - os: osx
      osx_image: xcode12.1
      env: TARGET=x86_64-apple-darwin TRAVIS_PYTHON_VERSION=3.8.1 RELEASE_PYTHON_VERSION=-cp38
      sudo: required
    - os: osx
      osx_image: xcode12.1
      env: TARGET=x86_64-apple-darwin TRAVIS_PYTHON_VERSION=3.9.5 RELEASE_PYTHON_VERSION=-cp39
      sudo: required

before_install:
  - echo $LATEST_TAG > key.txt
  - echo $PRE_CMD
  - bash ci/pre_install.sh

install:
  - bash ci/install.sh

cache: pip

script:
  - bash ci/script.sh
  # only run coverage reporting on OS X
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then
      source venv/bin/activate;
      python setup.py build_ext --inplace;
      nosetests --with-coverage --cover-package $PROJECT_NAME;
    fi

after_success:
  - if [ "$TRAVIS_OS_NAME" == "osx" ]; then
      source venv/bin/activate;
      coveralls;
    fi

before_deploy:
  - bash ci/before_deploy.sh

deploy:
  provider: releases
  # TODO Regenerate this api_key for your project, this one won't work for you. Here's how:
  # - Go to 'https://github.com/settings/tokens/new' and generate a Token with only the
  # `public_repo` scope enabled
  # - Call `travis encrypt $github_token` where $github_token is the token you got in the previous
  # step and `travis` is the official Travis CI gem (see https://rubygems.org/gems/travis/)
  # - Enter the "encrypted value" below
  api_key:
        - secure: Ep/8a6Iv5N5f34wl/xNroLuLdUXU7/TNzT7ONQUw4s9uZbOd3myRQlBN7tzs5ipfUxMYk7NOC+MclL6Dk1dQUwxnp1DSBFpf3Fvu1BDH4TudFyDKH723LEw3L/5KJdYrNl8GxfdgMQIUwsox9rgy8Ejzye3ksge5VV/0VtOT52lSedZ68BXH9dDwRSVrWCoiQQFM82NO9Z2Y2RCPBULknjU8Z28OuQys9axom1lEKo7UoqyHuP5Mz++u8lHFOn/zvqgJ11zbG3IVroszjTzjQgmYB8MssjOeN407JzcwHg4W++XPen0LDVnRIN4iciQNC+2ugq84IpGGqLaOWzLtCx6SqpqANHFhWksbdhibkqdans7yf5ANzmyAlg18QNAtTPKYYKue4sDGdYQPA+AL4noY5bn25c7JOU+ILJyyhLB5UxXC1lcjFQwuOB8LayiZPvNnf6khqcWotSN5sshnwSZVJMan1Pu8fT+Mz06508TY91C4SpJ0UZhZ3Vo2W4CAoNm4qGEnlIATb+0nelAhXHTBAjvbl/D5V9otkJDUfaKGvvAlnsnU1lHDrpZmJ9ljmNJ5k7f7XoHR2wFZDRX5kdIe/XTOjSEcszsL/mchINOGnLH1kFVlgn8rCLg/l0WoyIZov/KlHA4trhkt/ZHRd9594wICPipOf6JYmhBkvt8=
  file_glob: true
  file: ${PROJECT_NAME}-${TRAVIS_TAG}-${TARGET}${RELEASE_PYTHON_VERSION}.*
  # don't delete the artifacts from previous phases
  skip_cleanup: true
  # deploy when a new tag is pushed
  on:
    tags: true

branches:
  only:
    # Pushes and PR to the master branch
    - master
    # IMPORTANT Ruby regex to match tags. Required, or travis won't trigger deploys when a new tag
    # is pushed. This regex matches semantic versions like v1.2.3-rc4+2016.02.22
    - /^v\d+\.\d+\.\d+.*$/

notifications:
  email:
    on_success: never
